<html><head><title>WAR IS PEACE</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>
var pickRandom = function(array) { return array[Math.floor(array.length * Math.random())]; };

var randomNextWord = function(wordArray, a, b, c) {
  var allFourths = wordArray.filter(function(word, index) { return Math.min(index,3) == 3 && wordArray[index-3] == a && wordArray[index-2] == b && wordArray[index-1] == c; });
  return pickRandom(allFourths);  // O(n), but n is small.
};

var apologize = function() { $("#dissociation").text("Sorry, could not download the text."); };

window.storeAnyOriginData = function(data) { window.Orwell = data.contents; };

var trimOrwell = function(string) { return string.split(/\r?\n/).slice(53,10338).join(" \n "); };

var tokenize = function(string) { return string.split(/ +/); };

var clearOutput = function() { $("#dissociation").text(""); };

var wordToAppendable = function(word) { return (word == "\n" ? document.createElement("br") : (word.match(/[A-Z]{2,}/) ? $(document.createElement("b")).text(word) : word)); };

var appendToOutput = function(appendable) { $("#dissociation").append(appendable).append(" "); };


window.onload = function() {
  if(! window.Orwell) {
    apologize();
    return;
  }
  var orwellWords = tokenize(trimOrwell(window.Orwell));
  clearOutput();
  var a = "WAR";
  var b = "IS";
  var c = "PEACE";
  var d = "";
  var i = 500;
  while(i--) {
    d = randomNextWord(orwellWords, a, b, c);
    appendToOutput(wordToAppendable(a));
    a = b;
    b = c;
    c = d;
  }
}
</script>
</head>
<body>
<h1>Markov-chain-generated text based on 1984</h1>
<div id="dissociation">Fetching Orwell from Gutenberg Australia via Coral CDN via AnyOrigin.com, please wait...</div>
<script src="http://anyorigin.com/get/?url=http%3A//gutenberg.net.au.nyud.net/ebooks01/0100021.txt&callback=storeAnyOriginData"></script>
</body></html>
